---
layout: single
title: Tablez
permalink: /tablez/
author: true
---

# Introduction

Reverse engineering task from **CSAW** ctf.

```sh
tablEZ
Bobby was talking about tables a bunch, so I made some table stuff. I think this is what he was talking about...
Solves: 342
```

{% include toc %}

# Analysis

I like to start challenge by creating C like code. Most of the time I am not able to replicate the exact code that was used.
But what I end up with is really enough for me to get the basic idea of the program. It looks something like this.

```c
const char trans_tbl[] = {
    1, '\0xbb',
    2, '\0x9b',
    3, '\0xc4',
    4, '\0x6c',
    //...
    254,
    255
}

int get_tbl_entry(char c);

int main(void) {
    char flag_in[0x80];
    int i;

    char enc_flag[36];

    char[0] = 0xb1e711f59d73b327;
    char[8] = 0x30f4f9f9b399beb3;
    char[16] = 0xb19965237399711b;
    char[24] = 0xf9279923be111165;
    char[32] = 0x65059923;
    char[35] = 0xce;
    // Not sure here, but it is enough to get basic idea...

    puts("Please enter the flag: ");
    fgets(flag_in, 0x80, stdin);
    flag_in[strlen() - 1] = '\0';

    for(i = 0; i < strlen(flag_in); i++) {
	flag_in = get_tbl_entry(flag_in[i]);
    }

    if(i == 0x25 || strcmp(flag_in, enc_flag, 0x26) != 0) {
	puts("Wrong\n");
	return 1;
    }

    puts("Correct <3\n");
    return 0;
}

int get_tbl_entry(char c) {

    for(int i = 0; i < 0xff; i++) {
	if(trans_tbl[i*2] == c) {
	    return trans_tbl[i*2 + 1];
	}
    }

    return 0;
}
```

The concept of this program is to get the flag from user. Then check every character against the translation table.
The table contains key and value pairs. Where the input character(index) and output character(value) are mapped together.

# Writeup

First thing is to extract both encoded flag and translation table from the binary. I did this in **gdb** by placing following breakpoints.

```sh
0x00000000000009f7 <main+343>:   call   0x6f0 <strncmp@plt>         # encrypted flag
gdb-peda$ x/37bx 0x7fffffffe940
0x7fffffffe940: 0x27    0xb3    0x73    0x9d    0xf5    0x11    0xe7    0xb1
0x7fffffffe948: 0xb3    0xbe    0x99    0xb3    0xf9    0xf9    0xf4    0x30
0x7fffffffe950: 0x1b    0x71    0x99    0x73    0x23    0x65    0x99    0xb1
0x7fffffffe958: 0x65    0x11    0x11    0xbe    0x23    0x99    0x27    0xf9
0x7fffffffe960: 0x23    0x99    0x05    0x65    0xce
0x0000000000000865 <get_tbl_entry+27>:    lea    rax,[rip+0x200a14] # translation table
$ x/512bx 0x555555755280 # address of translation table
0x555555755280 <trans_tbl>:     0x01    0xbb    0x02    0x9b    0x03    0xc4    0x04    0x6c
0x555555755288 <trans_tbl+8>:   0x05    0x4a    0x06    0x2e    0x07    0x22    0x08    0x45
0x555555755290 <trans_tbl+16>:  0x09    0x33    0x0a    0xb8    0x0b    0xd5    0x0c    0x06
0x555555755298 <trans_tbl+24>:  0x0d    0x0a    0x0e    0xbc    0x0f    0xfa    0x10    0x79
0x5555557552a0 <trans_tbl+32>:  0x11    0x24    0x12    0xe1    0x13    0xb2    0x14    0xbf
0x5555557552a8 <trans_tbl+40>:  0x15    0x2c    0x16    0xad    0x17    0x86    0x18    0x60
0x5555557552b0 <trans_tbl+48>:  0x19    0xa4    0x1a    0xb6    0x1b    0xd8    0x1c    0x59
0x5555557552b8 <trans_tbl+56>:  0x1d    0x87    0x1e    0x41    0x1f    0x94    0x20    0x77
0x5555557552c0 <trans_tbl+64>:  0x21    0xf0    0x22    0x4f    0x23    0xcb    0x24    0x61
0x5555557552c8 <trans_tbl+72>:  0x25    0x25    0x26    0xc0    0x27    0x97    0x28    0x2a
0x5555557552d0 <trans_tbl+80>:  0x29    0x5c    0x2a    0x08    0x2b    0xc9    0x2c    0x9f
0x5555557552d8 <trans_tbl+88>:  0x2d    0x43    0x2e    0x4e    0x2f    0xcf    0x30    0xf9
0x5555557552e0 <trans_tbl+96>:  0x31    0x3e    0x32    0x6f    0x33    0x65    0x34    0xe7
0x5555557552e8 <trans_tbl+104>: 0x35    0xc5    0x36    0x39    0x37    0xb7    0x38    0xef
0x5555557552f0 <trans_tbl+112>: 0x39    0xd0    0x3a    0xc8    0x3b    0x2f    0x3c    0xaa
0x5555557552f8 <trans_tbl+120>: 0x3d    0xc7    0x3e    0x47    0x3f    0x3c    0x40    0x81
0x555555755300 <trans_tbl+128>: 0x41    0x32    0x42    0x49    0x43    0xd3    0x44    0xa6
0x555555755308 <trans_tbl+136>: 0x45    0x96    0x46    0x2b    0x47    0x58    0x48    0x40
0x555555755310 <trans_tbl+144>: 0x49    0xf1    0x4a    0x9c    0x4b    0xee    0x4c    0x1a
0x555555755318 <trans_tbl+152>: 0x4d    0x5b    0x4e    0xc6    0x4f    0xd6    0x50    0x80
0x555555755320 <trans_tbl+160>: 0x51    0x2d    0x52    0x6d    0x53    0x9a    0x54    0x3d
0x555555755328 <trans_tbl+168>: 0x55    0xa7    0x56    0x93    0x57    0x84    0x58    0xe0
0x555555755330 <trans_tbl+176>: 0x59    0x12    0x5a    0x3b    0x5b    0xb9    0x5c    0x09
0x555555755338 <trans_tbl+184>: 0x5d    0x69    0x5e    0xba    0x5f    0x99    0x60    0x48
0x555555755340 <trans_tbl+192>: 0x61    0x73    0x62    0xb1    0x63    0x7c    0x64    0x82
0x555555755348 <trans_tbl+200>: 0x65    0xbe    0x66    0x27    0x67    0x9d    0x68    0xfb
0x555555755350 <trans_tbl+208>: 0x69    0x67    0x6a    0x7e    0x6b    0xf4    0x6c    0xb3
0x555555755358 <trans_tbl+216>: 0x6d    0x05    0x6e    0xc2    0x6f    0x5f    0x70    0x1b
0x555555755360 <trans_tbl+224>: 0x71    0x54    0x72    0x23    0x73    0x71    0x74    0x11
0x555555755368 <trans_tbl+232>: 0x75    0x30    0x76    0xd2    0x77    0xa5    0x78    0x68
0x555555755370 <trans_tbl+240>: 0x79    0x9e    0x7a    0x3f    0x7b    0xf5    0x7c    0x7a
0x555555755378 <trans_tbl+248>: 0x7d    0xce    0x7e    0x0b    0x7f    0x0c    0x80    0x85
0x555555755380 <trans_tbl+256>: 0x81    0xde    0x82    0x63    0x83    0x5e    0x84    0x8e
0x555555755388 <trans_tbl+264>: 0x85    0xbd    0x86    0xfe    0x87    0x6a    0x88    0xda
0x555555755390 <trans_tbl+272>: 0x89    0x26    0x8a    0x88    0x8b    0xe8    0x8c    0xac
0x555555755398 <trans_tbl+280>: 0x8d    0x03    0x8e    0x62    0x8f    0xa8    0x90    0xf6
0x5555557553a0 <trans_tbl+288>: 0x91    0xf7    0x92    0x75    0x93    0x6b    0x94    0xc3
0x5555557553a8 <trans_tbl+296>: 0x95    0x46    0x96    0x51    0x97    0xe6    0x98    0x8f
0x5555557553b0 <trans_tbl+304>: 0x99    0x28    0x9a    0x76    0x9b    0x5a    0x9c    0x91
0x5555557553b8 <trans_tbl+312>: 0x9d    0xec    0x9e    0x1f    0x9f    0x44    0xa0    0x52
0x5555557553c0 <trans_tbl+320>: 0xa1    0x01    0xa2    0xfc    0xa3    0x8b    0xa4    0x3a
0x5555557553c8 <trans_tbl+328>: 0xa5    0xa1    0xa6    0xa3    0xa7    0x16    0xa8    0x10
0x5555557553d0 <trans_tbl+336>: 0xa9    0x14    0xaa    0x50    0xab    0xca    0xac    0x95
0x5555557553d8 <trans_tbl+344>: 0xad    0x92    0xae    0x4b    0xaf    0x35    0xb0    0x0e
0x5555557553e0 <trans_tbl+352>: 0xb1    0xb5    0xb2    0x20    0xb3    0x1d    0xb4    0x5d
0x5555557553e8 <trans_tbl+360>: 0xb5    0xc1    0xb6    0xe2    0xb7    0x6e    0xb8    0x0f
0x5555557553f0 <trans_tbl+368>: 0xb9    0xed    0xba    0x90    0xbb    0xd4    0xbc    0xd9
0x5555557553f8 <trans_tbl+376>: 0xbd    0x42    0xbe    0xdd    0xbf    0x98    0xc0    0x57
0x555555755400 <trans_tbl+384>: 0xc1    0x37    0xc2    0x19    0xc3    0x78    0xc4    0x56
0x555555755408 <trans_tbl+392>: 0xc5    0xaf    0xc6    0x74    0xc7    0xd1    0xc8    0x04
0x555555755410 <trans_tbl+400>: 0xc9    0x29    0xca    0x55    0xcb    0xe5    0xcc    0x4c
0x555555755418 <trans_tbl+408>: 0xcd    0xa0    0xce    0xf2    0xcf    0x89    0xd0    0xdb
0x555555755420 <trans_tbl+416>: 0xd1    0xe4    0xd2    0x38    0xd3    0x83    0xd4    0xea
0x555555755428 <trans_tbl+424>: 0xd5    0x17    0xd6    0x07    0xd7    0xdc    0xd8    0x8c
0x555555755430 <trans_tbl+432>: 0xd9    0x8a    0xda    0xb4    0xdb    0x7b    0xdc    0xe9
0x555555755438 <trans_tbl+440>: 0xdd    0xff    0xde    0xeb    0xdf    0x15    0xe0    0x0d
0x555555755440 <trans_tbl+448>: 0xe1    0x02    0xe2    0xa2    0xe3    0xf3    0xe4    0x34
0x555555755448 <trans_tbl+456>: 0xe5    0xcc    0xe6    0x18    0xe7    0xf8    0xe8    0x13
0x555555755450 <trans_tbl+464>: 0xe9    0x8d    0xea    0x7f    0xeb    0xae    0xec    0x21
0x555555755458 <trans_tbl+472>: 0xed    0xe3    0xee    0xcd    0xef    0x4d    0xf0    0x70
0x555555755460 <trans_tbl+480>: 0xf1    0x53    0xf2    0xfd    0xf3    0xab    0xf4    0x72
0x555555755468 <trans_tbl+488>: 0xf5    0x64    0xf6    0x1c    0xf7    0x66    0xf8    0xa9
0x555555755470 <trans_tbl+496>: 0xf9    0xb0    0xfa    0x1e    0xfb    0xd7    0xfc    0xdf
0x555555755478 <trans_tbl+504>: 0xfd    0x36    0xfe    0x7d    0xff    0x31    0x00    0x00
```

I used a byte format because that way I don't have to deal with endianness.
From this point it was just a matter of formating data and writing script to reverse the translation table.

# Solution

```python
#! /usr/bin/env python

import re

enc_flag = open('encoded_flag.txt').read()
trans_t  = open('flag.txt').read()

enc_flag = re.split('    |\n', enc_flag)[:-1]
trans_t  = re.split('    |\n', trans_t)[1::2]

flag = ''
for c in enc_flag:
    print('Processing: ' + c)
    flag += chr(trans_t.index(c) + 1) # + 1 is here becase table indexes start from 1

print(flag)
```